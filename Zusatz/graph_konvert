import networkx as nx
from pathlib import Path

# Pfade
input_path = Path("data/knowledge_graph") # Deine aktuelle Datei (ohne Endung)
output_path = Path("data/knowledge_graph_gephi.gexf") # Das Ziel f√ºr Gephi

def convert_to_gexf():
    print(f"Lese Graph von: {input_path}")
    
    try:
        # 1. Wir laden den GraphML (NetworkX erkennt das Format meist automatisch)
        # Falls der Dateiname keine Endung hat, helfen wir manchmal nach, 
        # aber nx.read_graphml sollte es schaffen.
        G = nx.read_graphml(str(input_path))
        
        print(f"‚úÖ Graph geladen: {len(G.nodes)} Knoten, {len(G.edges)} Kanten")
        
        # 2. Konvertierung f√ºr Gephi (GEXF)
        # Gephi mag manchmal keine komplexen Python-Objekte in den Metadaten.
        # Wir stellen sicher, dass alles Strings oder Zahlen sind.
        for node, data in G.nodes(data=True):
            for key, val in data.items():
                if val is None:
                    data[key] = ""
                else:
                    data[key] = str(val) # Sicherheitshalber alles zu String

        # 3. Speichern als GEXF
        nx.write_gexf(G, str(output_path))
        print(f"üéâ Erfolgreich konvertiert! Datei gespeichert unter:")
        print(f"   -> {output_path.absolute()}")
        print("\nANLEITUNG F√úR GEPHI:")
        print("1. √ñffne Gephi")
        print(f"2. Datei -> √ñffnen -> W√§hle '{output_path.name}' aus")
        print("3. Im Import-Bericht auf 'OK' klicken.")
        
    except Exception as e:
        print(f"‚ùå Fehler: {str(e)}")

if __name__ == "__main__":
    convert_to_gexf()