# ============================================================================
# DECENTRALIZED AI ARCHITECTURE - EDGE RAG CONFIGURATION
# ============================================================================
# Masterthesis: "Enhancing Reasoning Fidelity in Quantized SLMs on Edge"
# 
# VERSION 3.0.0 - KUZU GRAPH DATABASE INTEGRATION
# 
# CHANGES FROM v2.1.0:
# - Added graph_backend: "kuzu" (replaces NetworkX)
# - Added graph-specific retrieval settings
# - Enabled graph_weight for hybrid retrieval
# ============================================================================

project:
  name: "Graph-Augmented Edge-RAG"
  version: "3.0.0"
  author: "Jan Nietzard"
  institution: "RWTH Aachen"

# ============================================================================
# LANGUAGE MODEL CONFIGURATION
# ============================================================================
llm:
  provider: "ollama"
  model_name: "phi3"
  base_url: "http://localhost:11434"
  temperature: 0.3
  top_p: 0.9
  top_k: 40
  max_tokens: 256

# ============================================================================
# EMBEDDING MODEL
# ============================================================================
embeddings:
  provider: "ollama"
  model_name: "nomic-embed-text"
  base_url: "http://localhost:11434"
  embedding_dim: 768

# ============================================================================
# DOCUMENT INGESTION & CHUNKING
# ============================================================================
chunking:
  mode: "standard"
  chunk_size: 512
  chunk_overlap: 128
  min_chunk_size: 200
  enable_pdf_cleaning: true
  
  separators:
    - "\n\n"
    - "\n"
    - ". "
    - " "
    - ""

# ============================================================================
# VECTOR STORE (LanceDB)
# ============================================================================
vector_store:
  provider: "lancedb"
  db_path: "./data/vector_db"
  index_type: "ivfflat"
  distance_metric: "cosine"
  normalize_embeddings: true
  top_k_vectors: 10
  similarity_threshold: 0.3

# ============================================================================
# KNOWLEDGE GRAPH (KuzuDB) - NEW IN v3.0.0!
# ============================================================================
graph:
  enabled: true
  
  # Backend selection: "kuzu" (recommended) or "networkx" (fallback)
  backend: "kuzu"
  
  # Database path (directory for KuzuDB, file for NetworkX)
  graph_path: "./data/knowledge_graph_kuzu"
  
  # Graph traversal settings
  max_hops: 2                    # Maximum path length for traversal
  top_k_entities: 5              # Number of graph results
  expand_context: true           # Include surrounding chunks
  
  # Entity extraction (for future use)
  entity_extraction_enabled: false
  entity_extraction_method: "keyword"  # "keyword" or "ner"
  
  # Relationship types stored in graph
  relation_types:
    - "from_source"     # Chunk -> Document
    - "next_chunk"      # Chunk -> Chunk (sequential)
    - "mentions"        # Chunk -> Entity
    - "related_to"      # Entity -> Entity

# ============================================================================
# RETRIEVAL AUGMENTED GENERATION (RAG)
# ============================================================================
rag:
  # Mode: "vector", "graph", or "hybrid"
  retrieval_mode: "hybrid"
  
  # =========================================================================
  # HYBRID WEIGHTS - Ablation Study Configuration
  # =========================================================================
  # Experiment 1: Vector-only  → vector_weight=1.0, graph_weight=0.0
  # Experiment 2: Graph-only   → vector_weight=0.0, graph_weight=1.0
  # Experiment 3: Hybrid 70/30 → vector_weight=0.7, graph_weight=0.3
  # Experiment 4: Hybrid 50/50 → vector_weight=0.5, graph_weight=0.5
  # =========================================================================
  vector_weight: 0.7
  graph_weight: 0.3
  
  # Reranking (future work)
  reranking_enabled: false
  query_expansion_enabled: false

# ============================================================================
# QUANTIZATION SETTINGS
# ============================================================================
quantization:
  enabled: true
  bits: 4
  group_size: 128

# ============================================================================
# DATA PATHS
# ============================================================================
paths:
  root: "./"
  data: "./data"
  documents: "./data/documents"
  vector_db: "./data/vector_db"
  graph_db: "./data/knowledge_graph_kuzu"  # Updated for KuzuDB
  logs: "./logs"
  cache: "./cache"

# ============================================================================
# LOGGING
# ============================================================================
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file: "./logs/edge_rag.log"

# ============================================================================
# PERFORMANCE TUNING
# ============================================================================
performance:
  batch_size: 32
  num_workers: 2
  device: "cpu"
  cache_embeddings: true
  max_cache_size_mb: 512